<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh·∫≠n File - H·ªá th·ªëng truy·ªÅn file b·∫£o m·∫≠t</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üì• Nh·∫≠n File B·∫£o M·∫≠t</h1>
            <p class="subtitle">X√°c th·ª±c ch·ªØ k√Ω v√† gi·∫£i m√£ file</p>
        </header>

        <main class="main-content">
            <!-- User Registration Section -->
            <section class="user-section">
                <div class="form-group">
                    <label for="receiver-id">ID Ng∆∞·ªùi nh·∫≠n:</label>
                    <input type="text" id="receiver-id" class="form-control" placeholder="Nh·∫≠p ID c·ªßa b·∫°n">
                    <button id="register-btn" class="btn btn-primary" style="margin-top: 0.5rem;">
                        ƒêƒÉng k√Ω / K·∫øt n·ªëi
                    </button>
                </div>
                
                <div id="connection-status" class="alert alert-info" style="display: none;"></div>
            </section>

            <!-- Key Management Section -->
            <section id="key-section" style="display: none;">
                <h2>üîë Qu·∫£n l√Ω kh√≥a</h2>
                <div class="key-info">
                    <div class="form-group">
                        <label>Kh√≥a c√¥ng khai c·ªßa b·∫°n:</label>
                        <textarea id="public-key-display" class="form-control" rows="5" readonly></textarea>
                    </div>
                    <div class="form-group">
                        <label for="private-key-input">Nh·∫≠p kh√≥a ri√™ng t∆∞ c·ªßa b·∫°n:</label>
                        <textarea id="private-key-input" class="form-control" rows="5" 
                                  placeholder="Paste your private key here..."></textarea>
                        <small style="color: #666;">‚ö†Ô∏è Kh√≥a ri√™ng t∆∞ ch·ªâ ƒë∆∞·ª£c l∆∞u locally, kh√¥ng g·ª≠i l√™n server</small>
                    </div>
                </div>
            </section>

            <!-- Received Files Section -->
            <section id="received-files-section" style="display: none;">
                <h2>üì® File ƒë√£ nh·∫≠n</h2>
                <div id="received-files-list" class="transfer-history">
                    <p style="text-align: center; color: #666;">Ch∆∞a c√≥ file n√†o ƒë∆∞·ª£c nh·∫≠n</p>
                </div>
            </section>

            <!-- File Processing Section -->
            <section id="process-section" style="display: none;">
                <h2>üîì X·ª≠ l√Ω file nh·∫≠n ƒë∆∞·ª£c</h2>
                <div id="file-process-info" class="alert alert-info">
                    <p><strong>File:</strong> <span id="process-file-name"></span></p>
                    <p><strong>Ng∆∞·ªùi g·ª≠i:</strong> <span id="process-sender"></span></p>
                    <p><strong>Th·ªùi gian:</strong> <span id="process-time"></span></p>
                </div>

                <button id="decrypt-btn" class="btn btn-primary btn-large">
                    <span class="btn-icon">üîì</span>
                    <span>Gi·∫£i m√£ file</span>
                </button>

                <div id="decrypt-progress" style="display: none; margin-top: 1rem;">
                    <div class="progress">
                        <div class="progress-bar" style="width: 0%">0%</div>
                    </div>
                    <p id="progress-status"></p>
                </div>

                <!-- Decryption Results -->
                <div id="decrypt-results" style="display: none; margin-top: 2rem;">
                    <h3>K·∫øt qu·∫£ x√°c th·ª±c v√† gi·∫£i m√£</h3>
                    
                    <div id="signature-status" class="alert">
                        <p><strong>Ch·ªØ k√Ω s·ªë:</strong> <span id="signature-result"></span></p>
                    </div>
                    
                    <div id="integrity-status" class="alert">
                        <p><strong>T√≠nh to√†n v·∫πn:</strong> <span id="integrity-result"></span></p>
                    </div>
                    
                    <div id="file-actions" style="display: none; margin-top: 1rem;">
                        <button id="download-btn" class="btn btn-success">
                            <span>üíæ</span>
                            <span>T·∫£i file ƒë√£ gi·∫£i m√£</span>
                        </button>
                        
                        <button id="view-content-btn" class="btn btn-secondary" style="display: none;">
                            <span>üëÅÔ∏è</span>
                            <span>Xem n·ªôi dung</span>
                        </button>
                    </div>
                    
                    <!-- File Content Viewer -->
                    <div id="file-viewer" style="display: none; margin-top: 1rem;">
                        <h4>N·ªôi dung file:</h4>
                        <div class="file-editor">
                            <textarea id="file-content-view" class="form-control" readonly></textarea>
                        </div>
                    </div>
                </div>

                <!-- Warning for corrupted files -->
                <div id="corruption-warning" class="alert alert-warning" style="display: none;">
                    <p><strong>‚ö†Ô∏è C·∫£nh b√°o:</strong> File kh√¥ng to√†n v·∫πn - c√≥ th·ªÉ ƒë√£ b·ªã thay ƒë·ªïi!</p>
                    <p>B·∫°n v·∫´n mu·ªën ti·∫øp t·ª•c gi·∫£i m√£?</p>
                    <button id="continue-decrypt-btn" class="btn btn-danger">
                        Ti·∫øp t·ª•c gi·∫£i m√£
                    </button>
                    <button id="cancel-decrypt-btn" class="btn btn-secondary">
                        H·ªßy b·ªè
                    </button>
                </div>
            </section>

            <!-- Transfer History -->
            <section id="history-section" style="display: none;">
                <div class="transfer-history">
                    <h2>üìú L·ªãch s·ª≠ nh·∫≠n file</h2>
                    <div id="transfer-history-list"></div>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2024 Secure File Transfer System. <a href="/" style="color: white;">Trang ch·ªß</a></p>
        </footer>
    </div>

    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- CryptoJS for client-side encryption -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- JSEncrypt for RSA -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"></script>
    <!-- Application Scripts -->
    <script src="{{ url_for('static', filename='js/crypto.js') }}"></script>
    <script src="{{ url_for('static', filename='js/socket.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Initialize receiver interface
        document.addEventListener('DOMContentLoaded', function() {
            initializeReceiverInterface();
        });
    </script>
</body>
</html>